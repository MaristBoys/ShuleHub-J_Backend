# ===============================================================
# SHULEHUB - CONFIGURAZIONE APPLICATIVA
# ===============================================================

# Nome dell'applicazione
spring.application.name=shulehub-backend

# --- CONFIGURAZIONE DATABASE (Sincronizzata con Render/Supabase) ---
# Usa le variabili d'ambiente se presenti, altrimenti usa i valori locali
spring.datasource.url=${SPRING_DATASOURCE_URL:jdbc:postgresql://localhost:5432/shulehub_db}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME:postgres}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD:password_locale}
spring.datasource.driver-class-name=org.postgresql.Driver
# Ottimizzazione pool connessioni
spring.datasource.hikari.keepaliveTime=30000
spring.datasource.hikari.maxLifetime=1800000

# --- CONFIGURAZIONE JPA / HIBERNATE ---
# 'update' crea/aggiorna le tabelle automaticamente
spring.jpa.hibernate.ddl-auto=${SPRING_JPA_HIBERNATE_DDL_AUTO:update}
spring.jpa.show-sql=false
# Rimosso il dialetto manuale per seguire le best practice Hibernate 6+
#spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect

# --- SICUREZZA & JWT --- 
# Prende JWT_SECRET_ENV da Render (JWT_SECRET_ENV), altrimenti usa il default locale 
shulehub.jwt.secret=${JWT_SECRET_ENV:0123456789ABCDEF0123456789ABCDEF0123456789ABCDEF0123456789ABCDEF}

# --- CONFIGURAZIONE SERVER ---
# Porta standard per Spring Boot (Render la rileva automaticamente)
server.port=8080
# Abilita il supporto ai proxy (Render) per leggere l'IP reale di chi effettua la chiamata (lo prende dall'header X-Forwarded-For)
    #Quando la richiesta attraversa il bilanciatore di carico di Render,
    #l'IP originale del tuo smartphone o computer viene messo in un "sacchetto" chiamato X-Forwarded-For.
    #Con l'impostazione native, Spring Boot capisce che non deve guardare chi gli sta consegnando il pacchetto (il proxy),
    # ma deve guardare dentro il sacchetto per trovare l'IP vero.
server.forward-headers-strategy=native



# --- GESTIONE ERRORI ---
# Evita di mostrare troppi dettagli tecnici nelle risposte API per sicurezza
server.error.include-stacktrace=never


# DISABILITAZIONE OPEN-IN-VIEW (OSIV)
# Motivo: Migliorare le performance e prevenire il problema delle query "N+1".
# Di default Spring tiene aperta la sessione DB fino alla fine della richiesta HTTP, 
# il che può causare query superflue durante il rendering della risposta.
# Avendo implementato il "Relazionale Puro" e la "Constructor Projection" nei DTO, 
# carichiamo già tutti i dati necessari in modo esplicito ed efficiente.
spring.jpa.open-in-view=false







